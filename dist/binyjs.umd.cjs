(function(d,f){typeof exports=="object"&&typeof module<"u"?module.exports=f():typeof define=="function"&&define.amd?define(f):(d=typeof globalThis<"u"?globalThis:d||self,d.binyJS=f())})(this,function(){"use strict";const d=t=>Object.assign(Object.create(f),t),f={get resp(){return this._resp},set resp(t){this._resp=t,Array.isArray(t)||(this.renderAction="assign",this._resp=[t]),this.renderAction||(this.renderAction="assign"),this._resp&&this._target&&y({target:this._target,renderAction:this.renderAction,response:this._resp,key:this.key}),this._resp=""},get key(){return this._key},set key(t){this._key=t},get deps(){return this._deps},set deps(t){this._deps=t},get target(){return this._target},set target(t){this._target=t},get action(){return this._action},set action(t){this._action=t},get val(){return this._val},set val(t){const e=this,n=e.key??"id";if(e._val=t,Array.isArray(t)&&(!e.oldVal&&(e.oldVal=new Map),e.target)){const{diff:c,action:s,curMap:l,swap:i}=k({newVector:t,curMap:new Map([...e.oldVal]),key:n});e.swap=i,e.oldVal=l,e._val=c,e.renderAction=s}if(e.renderAction==="clear")return y({target:e.target,renderAction:e.renderAction});(e._val!==null||e._val!==void 0)&&(e.renderAction==="swap"?y({target:e.target,renderAction:e.renderAction,key:e.key,swap:e.swap,response:e._val}):e.target&&e.target.dispatchEvent(new Event("change"))),!Array.isArray(t)&&(e.oldVal=t),e._val=t,e.renderAction=""}},p={get actions(){return this._actions},set actions(t){this._actions=t}},_=t=>p.actions=t;function g(t){for(let e of[...t.querySelectorAll("[data-change]")])e.onchange=p.actions[e.dataset.change];for(let e of[...t.querySelectorAll("[data-input]")])e.oninput=p.actions[e.dataset.input];for(let e of[...t.querySelectorAll("[data-submit]")])e.onsubmit=p.actions[e.dataset.submit];for(let e of[...t.querySelectorAll("[data-click]")])e.onclick=p.actions[e.dataset.click]}window.addEventListener("load",()=>g(app));function u(t,e){const n=t.tagName;let c;return n==="TBODY"?c=new DOMParser().parseFromString(`<table><tbody>${e}</tbody></table>`,"text/html").querySelector("tbody"):c=new DOMParser().parseFromString(`<${n}>${e}</${n}>`,"text/html").querySelector(n),g(c),c.childNodes}function y({target:t,response:e,renderAction:n,key:c,swap:s}){({assign:()=>(t.innerHTML=e.join(""),g(t)),append:()=>{const i=u(t,e.join(""));t.append(...i)},clear:()=>(t.innerHTML="",g(document)),remove:()=>{const i=u(t,e.join(""));for(let r of[...i]){const o=Number(r.getAttribute("key"));t.querySelector(`[key="${o}"]`).remove()}},swap:()=>{const[i,r]=s;t.insertBefore(t.children[i-1],t.children[r-1]),t.insertBefore(t.children[r-1],t.children[i-1])},update:function(){const i=[...u(t,e.join(""))],r=i[0].getAttribute("key");for(let o of i)t.childNodes[o.getAttribute("key")-r].replaceWith(o)}})[n]()}function k({newVector:t,curMap:e,key:n}){if(t.length===0&&e.size>1)return{action:"clear",curMap:new Map,diff:[],swap:[]};{const c=e.size,s=new Map,l=new Map([...e]),i=[];for(let a of t)e.has(a)?l.delete(a):(e.set(a,a[n]),s.set(a,a[n]));if(l.size>0)for(let a of l.keys())e.delete(a);if(s.size==0){let a=[...e.entries()].sort(([h,A],[b,v])=>h[n]<b[n]&&-1);for(let[h,A]of[...t.entries()])A[n]!==a[h][1]&&(i.push(h+1),e.set(a[h][0],A[n]));a=[]}let r,o;return l.size>0&&s.size==0?(r="remove",o=[...l.keys()]):i.length>0?(r="swap",o=[...s.keys()]):l.size==0&&s.size>0&&c>0?(r="append",o=[...s.keys()]):l.size==s.size&&s.size<e.size?(r="update",o=[...s.keys()]):(r="assign",o=t),{action:r,diff:o,curMap:e,swap:i.sort()}}}return{state:d,Actions:_}});
