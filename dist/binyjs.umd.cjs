(function(d,f){typeof exports=="object"&&typeof module<"u"?module.exports=f():typeof define=="function"&&define.amd?define(f):(d=typeof globalThis<"u"?globalThis:d||self,d.binyJS=f())})(this,function(){"use strict";const d=t=>Object.assign(Object.create(f),t),f={get resp(){return this._resp},set resp(t){this._resp=t,Array.isArray(t)||(this.renderAction="assign",this._resp=[t]),this._resp&&this._target&&u({target:this._target,renderAction:this.renderAction,response:this._resp,key:this.key}),this._resp=""},get key(){return this._key},set key(t){this._key=t},get deps(){return this._deps},set deps(t){this._deps=t},get target(){return this._target},set target(t){this._target=t},get action(){return this._action},set action(t){this._action=t},get val(){return this._val},set val(t){const e=this,n=e.key??"id";if(e._val=t,Array.isArray(t)&&(!e.oldVal&&(e.oldVal=new Map),e.target)){const{diff:l,action:o,curM:s,swap:i}=_({v:t,curM:new Map([...e.oldVal]),key:n});e.swap=i,e.oldVal=s,e._val=l,e.renderAction=o}if(e.renderAction==="clear")return u({target:e.target,renderAction:e.renderAction});e._val&&(["remove","swap"].includes(e.renderAction)?u({target:e.target,renderAction:e.renderAction,key:e.key,swap:e.swap}):e.target&&e.target.dispatchEvent(new Event("change"))),!Array.isArray(t)&&(e.oldVal=t),e._val=t}},p={get actions(){return this._actions},set actions(t){this._actions=t}},w=t=>p.actions=t;function g(t){console.log(t);for(let e of[...t.querySelectorAll("[data-change]")])e.onchange=p.actions[e.dataset.change];for(let e of[...t.querySelectorAll("[data-input]")])e.oninput=p.actions[e.dataset.input];for(let e of[...t.querySelectorAll("[data-submit]")])e.onsubmit=p.actions[e.dataset.submit];for(let e of[...t.querySelectorAll("[data-click]")])e.onclick=p.actions[e.dataset.click]}window.addEventListener("load",()=>g(app));function A(t,e){const n=t.tagName;let l;return n==="TBODY"?l=new DOMParser().parseFromString(`<table><tbody>${e}</tbody></table>`,"text/html").querySelector("tbody"):l=new DOMParser().parseFromString(`<${n}>${e}</${n}>`,"text/html").querySelector(n),g(l),l.childNodes}function u({target:t,response:e,renderAction:n,key:l,swap:o}){({assign:()=>(t.innerHTML=e.join(""),g(t)),append:()=>{const i=A(t,e);t.append(...i)},clear:()=>(t.innerHTML="",g(document)),remove:()=>t.parentElement.removeChild(t),swap:()=>{const[i,r]=o;t.insertBefore(t.children[i-1],t.children[r-1]),t.insertBefore(t.children[r-1],t.children[i-1])},update:function(){const i=[...A(t,e)],r=i[0].getAttribute("key");for(let c of i)t.childNodes[c.getAttribute("key")-r].replaceWith(c)}})[n]()}function _({v:t,curM:e,key:n}){if(t.length===0&&e.size>1)return{action:"clear",curM:new Map,diff:[],swap:[]};{const l=e.size,o=new Map,s=new Map([...e]),i=[];for(let a of t)e.has(a)?s.delete(a):(e.set(a,a[n]),o.set(a,a[n]));if(s.size>0)for(let a of s.keys())e.delete(a);if(o.size==0){let a=[...e.entries()].sort(([h,y],[b,k])=>h[n]<b[n]&&-1);for(let[h,y]of[...t.entries()])y[n]!==a[h][1]&&(i.push(h+1),e.set(a[h][0],y[n]));a=[]}let r;s.size==1&&o.size==0?r="remove":i.length>0?r="swap":s.size==0&&l>0?r="append":s.size==0&&l==0?r="assign":s.size==o.size&&o.size<e.size?r="update":r="assign";let c;return s.size>0&&o.size==0?c=[...s.keys()]:c=[...o.keys()],{action:r,diff:c,curM:e,swap:i.sort()}}}return{state:d,Actions:w}});
