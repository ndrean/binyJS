(function(l,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(l=typeof globalThis<"u"?globalThis:l||self,l.binyJS=d())})(this,function(){"use strict";const l=t=>Object.assign(Object.create(d),t),d={get resp(){return this._resp},set resp(t){this._resp=t,Array.isArray(t)||(this.renderAction="assign",this._resp=[t]),this._resp&&this._target&&g({target:this._target,renderAction:this.renderAction,response:this._resp,key:this.key}),this._resp=""},get key(){return this._key},set key(t){this._key=t},get deps(){return this._deps},set deps(t){this._deps=t},get target(){return this._target},set target(t){this._target=t},get action(){return this._action},set action(t){this._action=t},get val(){return this._val},set val(t){const e=this,n=e.key??"id";if(e._val=t,Array.isArray(t)&&(!e.oldVal&&(e.oldVal=new Map),e.target)){const{diff:p,action:a,curM:i,swap:o}=w({v:t,curM:new Map([...e.oldVal]),key:n});e.swap=o,e.oldVal=i,e._val=p,e.renderAction=a}if(e.renderAction==="clear")return g({target:e.target,renderAction:e.renderAction});e._val&&(["remove","swap"].includes(e.renderAction)?g({target:e.target,renderAction:e.renderAction,key:e.key,swap:e.swap}):e.target&&e.target.dispatchEvent(new Event("change"))),!Array.isArray(t)&&(e.oldVal=t),e._val=t}},f={get actions(){return this._actions},set actions(t){this._actions=t}},A=t=>f.actions=t;function y(t){for(let e of[...t.querySelectorAll("[data-change]")])e.onchange=f.actions[e.dataset.change];for(let e of[...t.querySelectorAll("[data-input]")])e.oninput=f.actions[e.dataset.input];for(let e of[...t.querySelectorAll("[data-submit]")])e.onsubmit=f.actions[e.dataset.submit];for(let e of[...t.querySelectorAll("[data-click]")])e.onclick=f.actions[e.dataset.click]}window.addEventListener("load",()=>y(app));function _(t,e){const n=t.tagName;return n==="TBODY"?new DOMParser().parseFromString(`<table><tbody>${e}</tbody></table>`,"text/html").querySelector("tbody").childNodes:new DOMParser().parseFromString(`<${n}>${e}</${n}>`,"text/html").querySelector(n).childNodes}function g({target:t,response:e,renderAction:n,key:p,swap:a}){({assign:()=>t.innerHTML=e.join(""),append:()=>t.insertAdjacentHTML("beforeEnd",e.join("")),clear:()=>(t.innerHTML="",y(document)),remove:()=>t.parentElement.removeChild(t),swap:()=>{const[o,s]=a;t.insertBefore(t.children[o-1],t.children[s-1]),t.insertBefore(t.children[s-1],t.children[o-1])},update:function(){const o=[..._(t,e)],s=o[0].getAttribute("key");for(let c of o)t.childNodes[c.getAttribute("key")-s].replaceWith(c)}})[n]()}function w({v:t,curM:e,key:n}){if(t.length===0&&e.size>1)return{action:"clear",curM:new Map,diff:void 0,swap:void 0};{const p=e.size,a=new Map,i=new Map([...e]),o=[];for(let r of t)e.has(r)?i.delete(r):(e.set(r,r[n]),a.set(r,r[n]));if(i.size>0)for(let r of i.keys())e.delete(r);if(a.size==0){let r=[...e.entries()].sort(([h,u],[b,k])=>h[n]<b[n]&&-1);for(let[h,u]of[...t.entries()])u[n]!==r[h][1]&&(o.push(h+1),e.set(r[h][0],u[n]));r=[]}let s;i.size==1&&a.size==0?s="remove":o.length>0?s="swap":i.size==0&&p>0?s="append":i.size==0&&p==0?s="assign":i.size==a.size&&a.size<e.size?s="update":s="assign";let c;return i.size>0&&a.size==0?c=[...i.keys()]:c=[...a.keys()],{action:s,diff:c,curM:e,swap:o.sort()}}}return{state:l,Actions:A}});
